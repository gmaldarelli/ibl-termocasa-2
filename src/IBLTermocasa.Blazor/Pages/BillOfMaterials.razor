@page "/bill-of-materials"

@attribute [Authorize(IBLTermocasaPermissions.BillOfMaterials.Default)]
@using IBLTermocasa.BillOfMaterials
@using IBLTermocasa.Localization
@using IBLTermocasa.Permissions
@using IBLTermocasa.RequestForQuotations
@using Microsoft.AspNetCore.Authorization
@using Volo.Abp.AspNetCore.Components.Messages
@using Volo.Abp.AspNetCore.Components.Web
@using Volo.Abp.AspNetCore.Components.Web.Theming.Layout
@using Volo.Abp.Http.Client
@using IBLTermocasa.Types
@using MudBlazor
@using IBLTermocasa.Blazor.Components.BillOfMaterial
@inherits IBLTermocasaComponentBase
@inject IBillOfMaterialsAppService BillOfMaterialsAppService
@inject IRequestForQuotationsAppService RequestForQuotationsAppService

@inject IUiMessageService UiMessageService
@inject AbpBlazorMessageLocalizerHelper<IBLTermocasaResource> LH
@inject IRemoteServiceConfigurationProvider RemoteServiceConfigurationProvider
@inject NavigationManager NavigationManager

@* ************************* PAGE HEADER ************************* *@
<PageHeader Title="@L["BillOfMaterials"]" BreadcrumbItems="BreadcrumbItems" Toolbar="Toolbar">

</PageHeader>



@* ************************* DATA GRID ************************* *@

<MudCard>
    <MudCardContent>
        <MudDataGrid Items="BillOfMaterialList">
            <Columns>
                <PropertyColumn Property="x => x.BomNumber" Title="@L["Name"]"/>
                <TemplateColumn Title="@L["BomStatus"]">
                    <CellTemplate Context="context">
                        @L[$"Enum:BomStatusType.{EnumExtensions.GetDisplayName(context.Item.Status)}"]
                    </CellTemplate>
                </TemplateColumn>
                <PropertyColumn Property="x => x.CreationTime" Title="@L["BomDate"]" Format="dd/MM/yyyy"/>
                <PropertyColumn Property="x => x.RequestForQuotationProperty.RfqNumber" Title="@L["RfqNumber"]"/>
                <PropertyColumn Property="x => x.RequestForQuotationProperty.OrganizationName" Title="@L["Organization"]"/>
                <PropertyColumn Property="x => x.RequestForQuotationProperty.RfqDateDocument" Title="@L["RfqDateDocument"]" Format="dd/MM/yyyy"/>
                <TemplateColumn CellClass="d-flex justify-end">
                    <CellTemplate>
                        <MudIconButton Size="@MudBlazor.Size.Small" Icon="@MudBlazor.Icons.Material.Outlined.RemoveRedEye" OnClick="() => OpenBillOfMaterialDetailAsync(context.Item)"/>
                        <MudIconButton Size="@MudBlazor.Size.Small" Icon="@MudBlazor.Icons.Material.Outlined.Remove" OnClick="() => RemoveBillOfMaterialDetailAsync(context.Item)"/>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
    </MudCardContent>
</MudCard>

<ModalBillOfMaterialInput @ref="AddBillOfMaterialModal"
                          OnCancel="CloseModalBillOfMaterialAsync"
                          OnSave="SaveModalBillOfMaterialInputAsync"/>

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider />

