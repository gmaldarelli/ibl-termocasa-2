@using IBLTermocasa.Blazor.Components.Selector
@using MudBlazor
@inherits IBLTermocasaComponentBase

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            @L["QuestionTemplates"]
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudSelect @ref="MudSelectComponent"
                   MultiSelectionTextFunc="@(new Func<List<string>, string>(GetMultiSelectionText))"
                   MultiSelection="IsMultiSelection"
                   T="string" Label="@ProductLabelSingle"
                   AdornmentIcon="@Icons.Material.Filled.Search"
                   AnchorOrigin="Origin.BottomCenter"
                   ValueChanged="OnGuidStringSelectedChanged"
        >
            @foreach (var GuidString in ComponentList.Select(x => x.Id.ToString()).ToList())
            {
            <MudSelectItem T="string" Value="@GuidString">@ComponentName(@GuidString)</MudSelectItem>
            }
        </MudSelect>
        <MudNumericField @bind-Value="@ProductQuestionTemplate.Order" InvertMouseWheel="true"
                         Label="@L["Order"]" Variant="Variant.Filled" Min="@OrderMinValue" Max="@OrderMaxValue" />
        <MudTextField @bind-Value="@ProductQuestionTemplate.Name" Label="@L["Name"]" Variant="Variant.Filled" />
        <MudSwitch @bind-Checked="@ProductQuestionTemplate.Mandatory"
                   Class="mud-width-full"
                   Color="MudBlazor.Color.Primary">
            @L["Mandatory"]
        </MudSwitch>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@L["Cancel"]</MudButton>
        <MudButton Color="MudBlazor.Color.Primary" OnClick="AddQuestionTemplate">@L["Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    private void Cancel()
    {
        MudDialog.Cancel(); 
    }

    private void AddQuestionTemplate()
    {
        if(GuidStringSelected !=null )
        {
            ProductQuestionTemplate.QuestionTemplateId = Guid.Parse(GuidStringSelected);
            Console.WriteLine("ProductQuestionTemplate.ComponentId: " + ProductQuestionTemplate.QuestionTemplateId);
            MudDialog.Close(DialogResult.Ok(ProductQuestionTemplate));
        }
        else
        {
            //TODO: Show validation error
        }
    }
    
}